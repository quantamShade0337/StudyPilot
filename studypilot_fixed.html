<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyPilot - Smart Student Hub</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    :root {
      --brand-blue: rgb(99, 102, 241);
      --brand-purple: rgb(168, 85, 247);
      --brand-teal: rgb(20, 184, 166);
      --bg: #05070b;
      --surface: rgba(255, 255, 255, 0.06);
      --border: rgba(255, 255, 255, 0.12);
      --text: rgba(255, 255, 255, 0.92);
      --muted: rgba(255, 255, 255, 0.70);
      --muted-2: rgba(255, 255, 255, 0.55);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }
    
    h1, h2, h3, h4 { font-family: 'Outfit', sans-serif; }
    
    .grid-bg {
      background-image:
        radial-gradient(1200px 800px at 80% 10%, rgba(99,102,241,0.18), transparent 60%),
        radial-gradient(900px 700px at 10% 30%, rgba(168,85,247,0.15), transparent 60%),
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: auto, auto, 56px 56px, 56px 56px;
    }
    
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.04));
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: 0 20px 80px rgba(0,0,0,0.55);
      backdrop-filter: blur(14px);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 25px 90px rgba(0,0,0,0.65);
      border-color: rgba(255,255,255,0.18);
    }
    
    .btn {
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
    }
    
    .btn:active { transform: translateY(1px) scale(0.99); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--brand-blue), var(--brand-purple));
      color: white;
      box-shadow: 0 10px 30px rgba(99,102,241,0.25);
    }
    
    .btn-primary:hover:not(:disabled) {
      box-shadow: 0 15px 40px rgba(99,102,241,0.35);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      color: var(--text);
    }
    
    .btn-secondary:hover {
      background: rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.22);
    }
    
    .btn-success {
      background: linear-gradient(135deg, rgb(16, 185, 129), rgb(20, 184, 166));
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, rgb(239, 68, 68), rgb(220, 38, 38));
      color: white;
    }
    
    .input {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 12px;
      color: var(--text);
      outline: none;
      padding: 12px 16px;
      font-size: 14px;
      width: 100%;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .input:focus {
      border-color: rgba(99,102,241,0.55);
      box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
    }
    
    .input::placeholder { color: var(--muted-2); }
    
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: rgb(239, 68, 68);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
      display: none;
    }
    
    .success-message {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: rgb(16, 185, 129);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
      display: none;
    }
    
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .auth-card {
      max-width: 420px;
      width: 100%;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .hidden { display: none !important; }
  </style>
</head>
<body class="grid-bg">
  
  <!-- Authentication Screen -->
  <div id="authScreen" class="auth-container">
    <div class="card auth-card" style="padding: 40px;">
      <div style="text-align: center; margin-bottom: 32px;">
        <h1 style="font-size: 32px; font-weight: 800; margin-bottom: 8px; background: linear-gradient(135deg, var(--brand-blue), var(--brand-purple)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">StudyPilot</h1>
        <p style="color: var(--muted); font-size: 14px;">Your Smart Student Hub</p>
      </div>
      
      <div id="authError" class="error-message"></div>
      <div id="authSuccess" class="success-message"></div>
      
      <!-- Login Form -->
      <div id="loginForm">
        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 24px;">Welcome Back</h2>
        
        <form onsubmit="handleLogin(event)">
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600;">Email</label>
            <input type="email" id="loginEmail" class="input" placeholder="your@email.com" required>
          </div>
          
          <div style="margin-bottom: 24px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600;">Password</label>
            <input type="password" id="loginPassword" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          
          <button type="submit" id="loginBtn" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 15px; margin-bottom: 16px;">
            Sign In
          </button>
        </form>
        
        <div style="text-align: center;">
          <button onclick="showSignup()" class="btn btn-secondary" style="padding: 10px 24px; font-size: 14px;">
            Create Account
          </button>
        </div>
      </div>
      
      <!-- Signup Form -->
      <div id="signupForm" class="hidden">
        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 24px;">Create Account</h2>
        
        <form onsubmit="handleSignup(event)">
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600;">Email</label>
            <input type="email" id="signupEmail" class="input" placeholder="your@email.com" required>
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600;">Password</label>
            <input type="password" id="signupPassword" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" required>
          </div>
          
          <div style="margin-bottom: 24px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600;">Confirm Password</label>
            <input type="password" id="signupPasswordConfirm" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" required>
          </div>
          
          <button type="submit" id="signupBtn" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 15px; margin-bottom: 16px;">
            Create Account
          </button>
        </form>
        
        <div style="text-align: center;">
          <button onclick="showLogin()" class="btn btn-secondary" style="padding: 10px 24px; font-size: 14px;">
            Back to Login
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="appContainer" class="hidden">
    <div style="min-height: 100vh; padding: 32px;">
      <div style="max-width: 1200px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
          <h1 style="font-size: 32px; font-weight: 800;">Dashboard</h1>
          <button onclick="handleLogout()" class="btn btn-danger" style="padding: 12px 24px;">
            Logout
          </button>
        </div>
        
        <div class="card" style="padding: 32px; text-align: center;">
          <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 16px;">Welcome to StudyPilot!</h2>
          <p style="color: var(--muted); font-size: 16px; margin-bottom: 24px;">You're successfully logged in.</p>
          <p style="color: var(--muted-2); font-size: 14px;">Email: <span id="userEmail" style="color: var(--text); font-weight: 600;"></span></p>
          
          <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border);">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">ðŸŽ‰ Authentication Working!</h3>
            <p style="color: var(--muted); font-size: 14px;">
              Your login and signup are now fully functional. You can now build out the rest of your app features.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK v9 (modular) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    // ============ FIREBASE CONFIGURATION ============
    // REPLACE THESE WITH YOUR ACTUAL FIREBASE CONFIG
    const firebaseConfig = {
  apiKey: "AIzaSyCmmnXzel_rrxE7xM2mm0htu4Ehh9Eo6Rs",
  authDomain: "studypilot-92014.firebaseapp.com",
  databaseURL: "https://studypilot-92014-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "studypilot-92014",
  storageBucket: "studypilot-92014.firebasestorage.app",
  messagingSenderId: "267953191976",
  appId: "1:267953191976:web:0c625dc16e7fa8b822c91d",
  measurementId: "G-JF2MMTJW56"
};

    // Initialize Firebase
    let app, auth, database;
    
    try {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      database = getDatabase(app);
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization failed:', error);
      showError('Failed to connect to Firebase. Check your configuration.');
    }

    // ============ UI HELPER FUNCTIONS ============
    function showError(message) {
      const errorDiv = document.getElementById('authError');
      const successDiv = document.getElementById('authSuccess');
      successDiv.style.display = 'none';
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    function showSuccess(message) {
      const errorDiv = document.getElementById('authError');
      const successDiv = document.getElementById('authSuccess');
      errorDiv.style.display = 'none';
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      setTimeout(() => {
        successDiv.style.display = 'none';
      }, 3000);
    }

    function setLoading(buttonId, isLoading) {
      const btn = document.getElementById(buttonId);
      if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>';
      } else {
        btn.disabled = false;
        if (buttonId === 'loginBtn') {
          btn.textContent = 'Sign In';
        } else if (buttonId === 'signupBtn') {
          btn.textContent = 'Create Account';
        }
      }
    }

    window.showLogin = function() {
      document.getElementById('loginForm').classList.remove('hidden');
      document.getElementById('signupForm').classList.add('hidden');
      document.getElementById('authError').style.display = 'none';
      document.getElementById('authSuccess').style.display = 'none';
    }

    window.showSignup = function() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('signupForm').classList.remove('hidden');
      document.getElementById('authError').style.display = 'none';
      document.getElementById('authSuccess').style.display = 'none';
    }

    // ============ AUTHENTICATION FUNCTIONS ============
    window.handleSignup = async function(event) {
      event.preventDefault();
      
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('signupPasswordConfirm').value;
      
      // Validation
      if (password !== confirmPassword) {
        showError('Passwords do not match');
        return;
      }
      
      if (password.length < 6) {
        showError('Password must be at least 6 characters');
        return;
      }
      
      setLoading('signupBtn', true);
      
      try {
        console.log('Creating user account...');
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        console.log('âœ… User created:', user.uid);
        
        // Initialize user data in database
        const userRef = ref(database, 'users/' + user.uid);
        await set(userRef, {
          email: user.email,
          createdAt: new Date().toISOString(),
          tasks: [],
          exams: [],
          goals: [],
          studyTime: 0,
          streak: 0
        });
        
        console.log('âœ… User data initialized');
        showSuccess('Account created successfully!');
        
      } catch (error) {
        console.error('âŒ Signup error:', error);
        
        switch (error.code) {
          case 'auth/email-already-in-use':
            showError('This email is already registered');
            break;
          case 'auth/invalid-email':
            showError('Invalid email address');
            break;
          case 'auth/weak-password':
            showError('Password is too weak');
            break;
          case 'auth/network-request-failed':
            showError('Network error. Check your internet connection.');
            break;
          default:
            showError(error.message || 'Failed to create account');
        }
      } finally {
        setLoading('signupBtn', false);
      }
    }

    window.handleLogin = async function(event) {
      event.preventDefault();
      
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      setLoading('loginBtn', true);
      
      try {
        console.log('Signing in...');
        await signInWithEmailAndPassword(auth, email, password);
        console.log('âœ… Login successful');
        
      } catch (error) {
        console.error('âŒ Login error:', error);
        
        switch (error.code) {
          case 'auth/user-not-found':
          case 'auth/wrong-password':
          case 'auth/invalid-credential':
            showError('Invalid email or password');
            break;
          case 'auth/invalid-email':
            showError('Invalid email address');
            break;
          case 'auth/too-many-requests':
            showError('Too many failed attempts. Try again later.');
            break;
          case 'auth/network-request-failed':
            showError('Network error. Check your internet connection.');
            break;
          default:
            showError(error.message || 'Failed to sign in');
        }
      } finally {
        setLoading('loginBtn', false);
      }
    }

    window.handleLogout = async function() {
      try {
        await signOut(auth);
        console.log('âœ… Logout successful');
      } catch (error) {
        console.error('âŒ Logout error:', error);
        alert('Failed to logout: ' + error.message);
      }
    }

    // ============ AUTH STATE OBSERVER ============
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        console.log('âœ… User signed in:', user.email);
        
        // Show app, hide auth
        document.getElementById('authScreen').classList.add('hidden');
        document.getElementById('appContainer').classList.remove('hidden');
        
        // Display user email
        document.getElementById('userEmail').textContent = user.email;
        
        // Load user data
        try {
          const userRef = ref(database, 'users/' + user.uid);
          const snapshot = await get(userRef);
          
          if (snapshot.exists()) {
            console.log('âœ… User data loaded:', snapshot.val());
          } else {
            console.log('No user data found');
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
        
      } else {
        console.log('User signed out');
        
        // Show auth, hide app
        document.getElementById('authScreen').classList.remove('hidden');
        document.getElementById('appContainer').classList.add('hidden');
      }
    });

    console.log('ðŸš€ App initialized and ready');
  </script>

</body>
</html>
